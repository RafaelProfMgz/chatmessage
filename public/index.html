<!DOCTYPE html>
<html>
  <head>
    <title>Chat Simples com Socket.IO</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
      }
      #chat-container {
        max-width: 600px;
        margin: 20px auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      #messages {
        list-style-type: none;
        margin: 0;
        padding: 0;
        height: 300px;
        overflow-y: scroll;
        border: 1px solid #eee;
        border-radius: 4px;
        padding: 10px;
        margin-bottom: 10px;
        background-color: #f9f9f9;
      }
      #messages li {
        padding: 8px 0;
        border-bottom: 1px solid #eee;
      }
      #messages li:last-child {
        border-bottom: none;
      }
      .my-message {
        text-align: right;
        color: #007bff;
      }
      .other-message {
        text-align: left;
        color: #28a745;
      }
      .status-message {
        font-style: italic;
        color: #6c757d;
      }
      #user-id-form {
        margin-bottom: 20px;
        display: flex;
      }
      #user-id-form input {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px 0 0 4px;
      }
      #user-id-form button {
        padding: 10px 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
      }
      #user-id-form button:hover {
        background-color: #0056b3;
      }

      #form {
        display: flex;
        margin-top: 10px;
      }
      #form input[type="text"] {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px 0 0 4px;
      }
      #form input[type="text"]:focus {
        outline: none;
        border-color: #007bff;
      }
      #form button {
        padding: 10px 15px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
      }
      #form button:hover {
        background-color: #218838;
      }

      #private-chat-form {
        display: flex;
        margin-top: 10px;
        border-top: 1px solid #eee;
        padding-top: 10px;
      }
      #private-chat-form input[type="text"] {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px 0 0 4px;
        margin-right: 5px;
      }
      #private-chat-form input[type="text"]:focus {
        outline: none;
        border-color: #007bff;
      }
      #private-chat-form button {
        padding: 10px 15px;
        background-color: #ffc107;
        color: black;
        border: none;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
      }
      #private-chat-form button:hover {
        background-color: #e0a800;
      }
      #target-user-id {
        width: 100px;
      }
    </style>
  </head>
  <body>
    <div id="chat-container">
      <h1>Chat Simples</h1>

      <div id="user-id-setup">
        <p>Por favor, defina seu ID de usuário para começar a conversar:</p>
        <form id="user-id-form">
          <input
            id="userIdInput"
            autocomplete="off"
            placeholder="Seu ID de Usuário"
            required
          /><button type="submit">Entrar</button>
        </form>
      </div>

      <div id="chat-area" style="display: none">
        <p>Seu ID de Usuário: <strong id="currentUserIdDisplay"></strong></p>
        <ul id="messages"></ul>

        <form id="form">
          <input
            id="m"
            autocomplete="off"
            placeholder="Mensagem para todos"
          /><button type="submit">Enviar</button>
        </form>

        <form id="private-chat-form">
          <input
            id="target-user-id"
            autocomplete="off"
            placeholder="ID do Destinatário"
          />
          <input
            id="private-message"
            autocomplete="off"
            placeholder="Mensagem privada"
          /><button type="submit">Enviar Privada</button>
        </form>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const messages = document.getElementById("messages");
      const userIdForm = document.getElementById("user-id-form");
      const userIdInput = document.getElementById("userIdInput");
      const chatArea = document.getElementById("chat-area");
      const userIdSetup = document.getElementById("user-id-setup");
      const currentUserIdDisplay = document.getElementById(
        "currentUserIdDisplay"
      );
      let currentUserId = "";

      // Formulário para definir o ID do usuário
      userIdForm.addEventListener("submit", (e) => {
        e.preventDefault();
        if (userIdInput.value) {
          currentUserId = userIdInput.value;
          socket.emit("setUserId", currentUserId);
          currentUserIdDisplay.textContent = currentUserId;
          userIdSetup.style.display = "none";
          chatArea.style.display = "block";
        }
      });

      // Formulário de mensagem geral
      document.getElementById("form").addEventListener("submit", (e) => {
        e.preventDefault();
        const messageInput = document.getElementById("m");
        if (messageInput.value) {
          socket.emit("chatMessage", messageInput.value);
          const item = document.createElement("li");
          item.textContent = `Você (para todos): ${messageInput.value}`;
          item.classList.add("my-message");
          messages.appendChild(item);
          window.scrollTo(0, document.body.scrollHeight);
          messageInput.value = "";
        }
      });

      // Formulário de mensagem privada
      document
        .getElementById("private-chat-form")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          const targetUserIdInput = document.getElementById("target-user-id");
          const privateMessageInput =
            document.getElementById("private-message");
          if (targetUserIdInput.value && privateMessageInput.value) {
            socket.emit("privateMessage", {
              targetUserId: targetUserIdInput.value,
              message: privateMessageInput.value,
            });
            const item = document.createElement("li");
            item.textContent = `Você (para ${targetUserIdInput.value}): ${privateMessageInput.value}`;
            item.classList.add("my-message");
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
            privateMessageInput.value = "";
            targetUserIdInput.value = ""; // Limpa o ID do destinatário após enviar
          }
        });

      // Receber mensagens gerais
      socket.on("chatMessage", ({ senderId, message }) => {
        if (senderId !== currentUserId) {
          // Não exibe a mensagem geral que eu mesmo enviei (já adicionei localmente)
          const item = document.createElement("li");
          item.textContent = `${senderId}: ${message}`;
          item.classList.add("other-message");
          messages.appendChild(item);
          window.scrollTo(0, document.body.scrollHeight);
        }
      });

      // Receber mensagens privadas
      socket.on("privateMessage", ({ senderId, message }) => {
        const item = document.createElement("li");
        item.textContent = `(Privado de ${senderId}): ${message}`;
        item.classList.add("other-message");
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
      });

      // Receber status do servidor
      socket.on("status", (msg) => {
        const item = document.createElement("li");
        item.textContent = `[Sistema]: ${msg}`;
        item.classList.add("status-message");
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
      });
    </script>
  </body>
</html>
